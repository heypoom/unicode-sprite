<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Binary Editor</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" />

    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <main>
      <div
        class="container"
        @drop.prevent="handleFileDrop"
        @dragover.prevent
        v-cloak
      >
        <div
          v-for="(bit, at) in bits"
          class="sprite"
          :class="{on: bit, off: !bit}"
          @click="toggleBit(at)"
        >
          {{Number(bit)}}
        </div>
      </div>
    </main>

    <style scoped>
      body {
        margin: 0;
        font-family: 'JetBrains Mono', sans-serif;
      }

      main {
        color: white;
        background: black;
        min-height: 100vh;

        padding: 40px 0;

        display: flex;
        align-items: center;
        justify-content: center;
      }

      .container {
        display: grid;
        max-width: 1200px;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      }

      .sprite {
        display: flex;
        align-items: center;
        justify-content: center;

        font-weight: 500;
        font-size: 14px;
        width: 80px;
        height: 80px;

        cursor: pointer;
        user-select: none;
      }

      .sprite.off {
        color: white;
        background: black;
      }

      .sprite.on {
        color: black;
        background: white;
      }

      .mode-switch {
        display: block;
        margin-top: 15px;
        font-size: 13px;
        color: rgba(255, 255, 255, 0.7);
      }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

    <script>
      const sizeLimits = 1000

      const app = new Vue({
        el: 'main',
        data: {
          bits: Array.from({length: 120}, () => Number(Math.random() < 0.2)),
        },
        computed: {},
        methods: {
          async handleFileDrop(e) {
            const files = e.dataTransfer.files
            if (!files) return

            const [file] = files
            if (!file) return

            const buffer = await file.arrayBuffer()

            const hex = Array.from(new Uint8Array(buffer.slice(0, sizeLimits)))
            window.hex = hex

            const bits = hex
              .map((n) => n.toString(2).padStart(7, 0))
              .flatMap((str) => str.split('').map(Number))

            window.bits = bits
            this.bits = bits
          },

          /**
            @param {number} groupIndex
            @param {number} bitAt
          */
          toggleBit(bitAt) {
            const bits = [...this.bits]
            bits[bitAt] = Number(!bits[bitAt])

            this.bits = bits
          },
        },
      })
    </script>
  </body>
</html>
